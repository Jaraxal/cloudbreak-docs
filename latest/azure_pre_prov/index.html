<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        <link rel="canonical" href="http://sequenceiq.com/cloudbreak-docs/azure_pre_prov/">
        <link rel="shortcut icon" href="../img/favicon.ico">

	<title>Provisioning Prerequisites - Cloudbreak</title>

        <link href="../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="../css/highlight.css">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation" background="red">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <img class="navbar-logo" src="http://docs.hortonworks.com/HDPDocuments/Ambari-2.1.0.0/bk_Installing_HDP_AMB/common/images/hortonworks-logo.png" alt="Hortonworks Documentation" width="132" height="52">
            <a class="navbar-brand" href="..">Cloudbreak</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Home <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="..">Introduction</a>
</li>

                        
                            
<li >
    <a href="../architecture/">Architecture</a>
</li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Installation</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../onprem/">Cloudbreak Deployer</a>
</li>

        
            
<li >
    <a href="../aws-image/">AWS Cloud Images</a>
</li>

        
            
<li >
    <a href="../gcp-image/">GCP Cloud Images</a>
</li>

        
            
<li >
    <a href="../openstack-image/">OpenStack Cloud Images</a>
</li>

        
    </ul>
  </li>

                        
                            
<li >
    <a href="../releasenotes/">Release Notes</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Cloud Providers <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">AWS</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../aws/">Setup</a>
</li>

        
            
<li >
    <a href="../aws_pre_prov/">Provisioning Prerequisites</a>
</li>

        
            
<li >
    <a href="../aws_cb_ui/">Provisioning - UI</a>
</li>

        
            
<li >
    <a href="../aws_cb_shell/">Provisioning - CLI</a>
</li>

        
    </ul>
  </li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Azure</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../azure/">Setup</a>
</li>

        
            
<li class="active">
    <a href="./">Provisioning Prerequisites</a>
</li>

        
            
<li >
    <a href="../azure_cb_ui/">Provisioning - UI</a>
</li>

        
            
<li >
    <a href="../azure_cb_shell/">Provisioning - CLI</a>
</li>

        
    </ul>
  </li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">GCP</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../gcp/">Setup</a>
</li>

        
            
<li >
    <a href="../gcp_pre_prov/">Provisioning Prerequisites</a>
</li>

        
            
<li >
    <a href="../gcp_cb_ui/">Provisioning - UI</a>
</li>

        
            
<li >
    <a href="../gcp_cb_shell/">Provisioning - CLI</a>
</li>

        
    </ul>
  </li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">OpenStack</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../openstack/">Setup</a>
</li>

        
            
<li >
    <a href="../openstack_pre_prov/">Provisioning Prerequisites</a>
</li>

        
            
<li >
    <a href="../openstack_cb_ui/">Provisioning - UI</a>
</li>

        
            
<li >
    <a href="../openstack_cb_shell/">Provisioning - CLI</a>
</li>

        
    </ul>
  </li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Reference <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../api/">API</a>
</li>

                        
                            
<li >
    <a href="../shell/">CLI/Shell</a>
</li>

                        
                            
<li >
    <a href="../periscope/">Auto-Scaling</a>
</li>

                        
                            
<li >
    <a href="../recipes/">Recipes</a>
</li>

                        
                            
<li >
    <a href="../blueprints/">Blueprints</a>
</li>

                        
                            
<li >
    <a href="../kerberos/">Kerberos</a>
</li>

                        
                            
<li >
    <a href="../spi/">SPI</a>
</li>

                        
                            
<li >
    <a href="../operations/">Operations</a>
</li>

                        
                            
<li >
    <a href="../database/">Migration</a>
</li>

                        
                            
<li >
    <a href="../configuration/">Advanced Configuration</a>
</li>

                        
                            
<li >
    <a href="../development/">Development</a>
</li>

                        
                            
<li >
    <a href="../changelog/">Changelog</a>
</li>

                        
                        </ul>
                    </li>
                
                
                </ul>
            

            <ul class="nav navbar-nav navbar-right">
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Versions <b class="caret"></b></a>
                    <ul class="dropdown-menu" id="versions-dropdown">
                    </ul>
                </li>
                
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                
                    <li >
                        <a rel="next" href="../azure/">
                            <i class="fa fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../azure_cb_ui/">
                            Next <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
                
                
            </ul>
        </div>
    </div>
</div>

        <div class="container">
            
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#provisioning-prerequisites">Provisioning Prerequisites</a></li>
        
            <li><a href="#generate-a-new-ssh-key">Generate a new SSH key</a></li>
        
            <li><a href="#azure-access-setup">Azure access setup</a></li>
        
            <li><a href="#azure-application-setup-with-cloudbreak-deployer">Azure application setup with Cloudbreak Deployer</a></li>
        
            <li><a href="#filesystem-configuration">Filesystem configuration</a></li>
        
            <li><a href="#next-steps">Next steps</a></li>
        
    
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h1 id="provisioning-prerequisites">Provisioning Prerequisites</h1>
<p>We use the new <a href="https://azure.microsoft.com/en-us/documentation/articles/resource-group-overview/">Azure ARM</a> in 
order to launch clusters. In order to work we need to create an Active Directory application with the configured name and password and adds the permissions that are needed to call the Azure Resource Manager API. Cloudbreak deployer automates all this for you.</p>
<h2 id="generate-a-new-ssh-key">Generate a new SSH key</h2>
<p>All the instances created by Cloudbreak are configured to allow key-based SSH,
so you'll need to provide an SSH public key that can be used later to SSH onto the instances in the clusters you'll create with Cloudbreak.
You can use one of your existing keys or you can generate a new one.</p>
<p>To generate a new SSH keypair:</p>
<pre><code>ssh-keygen -t rsa -b 4096 -C &quot;your_email@example.com&quot;
# Creates a new ssh key, using the provided email as a label
# Generating public/private rsa key pair.
</code></pre>

<pre><code># Enter file in which to save the key (/Users/you/.ssh/id_rsa): [Press enter]
You'll be asked to enter a passphrase, but you can leave it empty.

# Enter passphrase (empty for no passphrase): [Type a passphrase]
# Enter same passphrase again: [Type passphrase again]
</code></pre>

<p>After you enter a passphrase the keypair is generated. The output should look something like below.</p>
<pre><code># Your identification has been saved in /Users/you/.ssh/id_rsa.
# Your public key has been saved in /Users/you/.ssh/id_rsa.pub.
# The key fingerprint is:
# 01:0f:f4:3b:ca:85:sd:17:sd:7d:sd:68:9d:sd:a2:sd your_email@example.com
</code></pre>

<p>Later you'll need to pass the <code>.pub</code> file's contents to Cloudbreak and use the private part to SSH to the instances.</p>
<h2 id="azure-access-setup">Azure access setup</h2>
<p>If you do not have an Active directory user then you have to configure it before deploying a cluster with Cloudbreak.</p>
<ol>
<li>
<p>Go to <code>manage.windowsazure.com</code> &gt; <code>Active Directory</code>
<img alt="" src="../images/azure1.png" /></p>
</li>
<li>
<p>You can configure your AD users on <code>Your active directory</code> &gt; <code>Users</code> menu
<img alt="" src="../images/azure2.png" /></p>
</li>
<li>
<p>Here you can add the new user to AD. Simply click on <code>Add User</code> on the bottom of the page
<img alt="" src="../images/azure3.png" /></p>
</li>
<li>
<p>Type the new user name into the box
<img alt="" src="../images/azure4.png" /></p>
</li>
<li>
<p>You will see the new user in the list. You have got a temporary password so you have to change it before you start using the new user.
<img alt="" src="../images/azure5.png" /></p>
</li>
<li>
<p>After you add the user to the AD you need to add your AD user to the <code>manage.windowsazure.com</code> &gt; <code>Settings</code> &gt; <code>Administrators</code>
<img alt="" src="../images/azure6.png" /></p>
</li>
<li>
<p>Here you can add the new user to Administrators. Simply click on <code>Add</code> on the bottom of the page
<img alt="" src="../images/azure7.png" /></p>
</li>
</ol>
<h2 id="azure-application-setup-with-cloudbreak-deployer">Azure application setup with Cloudbreak Deployer</h2>
<p>In order for Cloudbreak to be able to launch clusters on Azure on your behalf you need to set up your <strong>Azure ARM application</strong>. We have automated the Azure configurations in the Cloudbreak Deployer (CBD). After CBD has been installed, simply run the following command:</p>
<pre><code>cbd azure configure-arm --app_name myapp --app_password password123 --subscription_id 1234-abcd-efgh-1234
</code></pre>

<p><em>Options:</em></p>
<p><strong>--app_name</strong>: Your application name. Default is <em>app</em>.</p>
<p><strong>--app_password</strong>: Your application password. Default is <em>password</em>.</p>
<p><strong>--subscription_id</strong>: Your Azure subscription ID.</p>
<p><strong>--username</strong>: Your Azure username.</p>
<p><strong>--password</strong>: Your Azure password.</p>
<p>The command first creates an Active Directory application with the configured name and password and adds the permissions that are needed to call the Azure Resource Manager API.
Please use the output of the command when you creating your Azure credential in Cloudbreak.
The output of the command something like this:</p>
<pre><code>Subscription ID: sdf324-26b3-sdf234-ad10-234dfsdfsd
App ID: 234sdf-c469-sdf234-9062-dsf324
Password: password123
App Owner Tenant ID: sdwerwe1-d98e-dsf12-dsf123-df123232
</code></pre>

<h2 id="filesystem-configuration">Filesystem configuration</h2>
<p>When starting a cluster with Cloudbreak on Azure, the default filesystem is “Windows Azure Blob Storage with DASH”. Hadoop has built-in support for the <a href="https://hadoop.apache.org/docs/current/hadoop-azure/index.html">WASB filesystem</a> so it can be used easily as HDFS instead of disks.</p>
<h3 id="disks-and-blob-storage">Disks and blob storage</h3>
<p>In Azure every data disk attached to a virtual machine <a href="https://azure.microsoft.com/en-us/documentation/articles/virtual-machines-disks-vhds/">is stored</a> as a virtual hard disk (VHD) in a page blob inside an Azure storage account. Because these are not local disks and the operations must be done on the VHD files it causes degraded performance when used as HDFS.
When WASB is used as a Hadoop filesystem the files are full-value blobs in a storage account. It means better performance compared to the data disks and the WASB filesystem can be configured very easily but Azure storage accounts have their own <a href="https://azure.microsoft.com/en-us/documentation/articles/azure-subscription-service-limits/#storage-limits">limitations</a> as well. There is a space limitation for TB per storage account (500 TB) as well but the real bottleneck is the total request rate that is only 20000 IOPS where Azure will start to throw errors when trying to do an I/O operation.
To bypass those limits Microsoft created a small service called <a href="https://github.com/MicrosoftDX/Dash">DASH</a>. DASH itself is a service that imitates the API of the Azure Blob Storage API and it can be deployed as a Microsoft Azure Cloud Service. Because its API is the same as the standard blob storage API it can be used <em>almost</em> in the same way as the default WASB filesystem from a Hadoop deployment.
DASH works by sharding the storage access across multiple storage accounts. It can be configured to distribute storage account load to at most 15 <strong>scaleout</strong> storage accounts. It needs one more <strong>namespace</strong> storage account where it keeps track of where the data is stored.
When configuring a WASB filesystem with Hadoop, the only required config entries are the ones where the access details are described. To access a storage account Azure generates an access key that is displayed on the Azure portal or can be queried through the API while the account name is the name of the storage account itself. A DASH service has a similar account name and key, those can be configured in the configuration file while deploying the cloud service.</p>
<p><img alt="" src="../diagrams/dash.png" /></p>
<h3 id="deploying-a-dash-service-with-cloudbreak-deployer">Deploying a DASH service with Cloudbreak deployer</h3>
<p>We have automated the deployment of a DASH service in cloudbreak-deployer. After cbd is installed, simply run the following command to deploy a DASH cloud service with 5 scale out storage accounts:</p>
<pre><code>cbd azure deploy-dash --accounts 5 --prefix dash --location &quot;West Europe&quot; --instances 3
</code></pre>

<p>The command first creates the namespace account and the scaleout storage accounts, builds the <em>.cscfg</em> configuration file based on the created storage account names and keys, generates an Account Name and an Account Key for the DASH service and finally deploys the cloud service package file to a new cloud service.</p>
<p>The WASB filesystem configured with DASH can be used as a data lake - when multiple clusters are deployed with the same DASH filesystem configuration the same data can be accessed from all the clusters, but every cluster can have a different service configured as well. In that case deploy as many DASH services with cbd as clusters with Cloudbreak and configure them accordingly.</p>
<h2 id="next-steps">Next steps</h2>
<p>After these prerequisites are done you can move on to create clusters on the <a href="../azure_cb_ui/">UI</a> or with the <a href="../azure_cb_shell/">Shell</a>.</p>
<blockquote>
<p><strong>IMPORTANT:</strong> Make sure that your cloud account can launch instances using the new Azure ARM *(a.k.a. V2) API and you have sufficient qouta (CPU, network, etc) for the requested cluster size.</p>
</blockquote></div>
            
        </div>

        <footer class="col-md-12">
            <hr>
            
            <center>Documentation built with <a href="https://gliderlabs.com/pagebuilder">Pagebuilder</a>.</center>
        </footer>

        <script src="../js/jquery-1.10.2.min.js"></script>
        <script src="../js/bootstrap-3.0.3.min.js"></script>
        <script src="../js/highlight.pack.js"></script>
        <script>var base_url = '..';</script>
        <script data-main="../mkdocs/js/search.js" src="../mkdocs/js/require.js"></script>
        <script src="../js/base.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                    </div>
                    <div class="modal-body">
                        <p>
                            From here you can search these documents. Enter
                            your search terms below.
                        </p>
                        <form role="form">
                            <div class="form-group">
                                <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                            </div>
                        </form>
                        <div id="mkdocs-search-results"></div>
                    </div>
                    <div class="modal-footer">
                    </div>
                </div>
            </div>
        </div>

         <script>
           $( document ).ready(function() {
               $.getJSON("http://sequenceiq.com/cloudbreak-docs/versions.json", function(data) {
               $("#versions-dropdown").append('<li><a href="http://sequenceiq.com/cloudbreak-docs/latest">latest ('+data.latest+')</a></li>');
                $.each(data.versions, function( index, value ) {
                  $("#versions-dropdown").append('<li><a href="http://sequenceiq.com/cloudbreak-docs/'+value+'">'+value+'</a></li>');
                });
               });

               <!--AWS Table-->
               $.getJSON("../providers/aws.json", function(data) {
               $("#aws-image-details").append('<br>');
               $("#aws-image-details").append('<br>');
               $("#aws-image-details").append('<table>');
                 $("#aws-image-details").append('<col width="290">');
                 $("#aws-image-details").append('<col width="290">');
                 $("#aws-image-details").append('<thead>');
                  $("#aws-image-details").append('<tr>');
                   $("#aws-image-details").append('<th halign="center" style="font-size: 14pt;border:none;border-bottom:solid #DDDDDD 1.5pt;padding:6.0pt 6.0pt 6.0pt 6.0pt">' + "Region" + '</th>');
                   $("#aws-image-details").append('<th halign="center" style="font-size: 14pt;border:none;border-bottom:solid #DDDDDD 1.5pt;padding:6.0pt 6.0pt 6.0pt 6.0pt">' + "Image Name" + '</th>');
                  $("#aws-image-details").append('</tr>');
                 $("#aws-image-details").append('</thead>');
                $("#aws-image-details").append('<tbody>');
                 $.each(data.metadata, function( index, value ) {
                 if (index.indexOf("region.") === 0) {
                   shortIndex = index.substring(7)
                  $("#aws-image-details").append('<tr>');
                   $("#aws-image-details").append('<td halign="center" valign="center" text-align="left" style="font-size: 12pt;border:none;border-bottom:solid #DDDDDD 1.5pt;padding:6.0pt 6.0pt 6.0pt 6.0pt">' + shortIndex + '</td>');
                   $("#aws-image-details").append('<td halign="center" valign="center" text-align="right" style="font-size: 12pt;border:none;border-bottom:solid #DDDDDD 1.5pt;padding:6.0pt 6.0pt 6.0pt 6.0pt">' + value + '</td>');
                  $("#aws-image-details").append('</tr>');
                  }
                 });
                $("#aws-image-details").append('</tbody>');
               $("#aws-image-details").append('</table>');
               });

               <!--OpenStack-->
               $.getJSON("../providers/openstack.json", function(data) {
               $("#openstack-image-details").append('<br>');
               $("#openstack-image-details").append('<br>');
               $("#openstack-image-details").append('<p style="font-size: 12pt"><code>LATEST_IMAGE:</code>' + data.id + '</p>');
               $("#openstack-image-details").append('<pre><code style="font-size: 12pt;color:#333333">curl -L  https://atlas.hashicorp.com/api/v1/artifacts/sequenceiq/cbd/openstack.image/' + data.version + '/file | tar -xz</code></pre>');
               });

               <!--GCP-->
               $.getJSON("../providers/gcp.json", function(data) {
               $("#gcp-image-details").append('<br>');
               $("#gcp-image-details").append('<br>');
               $("#gcp-image-details").append('<pre><code style="font-size: 12pt;color:#333333">gcloud compute images create ' + data.gcp.id + ' --source-uri gs://' + data.gcp.source_image + '</code></pre>');
               });
           });
         </script>
    </body>
</html>
